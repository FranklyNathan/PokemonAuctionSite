<!doctype html>
<html class="sl-theme-dark">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auction Draft</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/themes/light.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/themes/dark.css" />
    <link rel="stylesheet" href="/style.css" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }

      /* Inline terminal-style welcome message (placed in page flow) */
      .welcome-terminal {
        font-family: Consolas, 'Courier New', monospace;
        background: #e0f2fe; /* light blue for light mode */
        color: #075985; /* dark blue text for light mode */
        padding: 0.8rem 1.2rem;
        border: 1px solid black;
        width: min(50%, 31ch); /* even narrower */
        box-sizing: border-box;
        border-radius: 0.125rem;
        margin: 1.25rem 0;
        /* reserve final height so the element doesn't grow when text appears */
        min-height: calc(1.2rem + 1.6rem); /* text line-height + vertical padding */
        display: flex;
        align-items: center;
        justify-content: flex-start; /* start left-aligned */
        gap: 0.5rem;
        font-size: 1.15rem; /* slightly larger overall */
      }

      /* allow dark-theme override */
      .sl-theme-dark .welcome-terminal {
        background: #002b36; /* deep terminal-like blue */
        color: #cfe8ff; /* light blue text */
      }

      #welcome-text {
        font-weight: 700;
        font-size: 1.2rem; /* larger font for the typed text */
        white-space: pre; /* preserve spaces if any */
        overflow: hidden;
        display: inline-block;
        /* reserve height when empty so layout doesn't shift */
        min-height: 1.2rem;
        text-align: left; /* left-align while typing */
        /* start hidden until the rest of the page (buttons) is ready to avoid popping */
        opacity: 0;
        transition: opacity 180ms ease;
      }

      /* NOTE: removed inner wrapper - text types left-aligned directly in the terminal */

      /* Block caret that blinks while typing */
      #welcome-caret {
        display: inline-block;
        width: 0.5ch;
        line-height: 1;
        animation: blink 1s steps(1, end) infinite;
        opacity: 0;
        transition: opacity 180ms ease;
      }

      /* Reveal the welcome text and caret only when the page is marked ready */
      body.ready #welcome-text,
      body.ready #welcome-caret {
        opacity: 1;
      }

      @keyframes blink {
        50% { opacity: 0; }
      }
      .sl-theme-dark .invert-in-dark-mode {
        filter: invert(1);
      }
      .sl-theme-dark sl-button[variant='neutral']::part(label) {
        color: white;
      }
      .control-button {
        --sl-spacing-x-small: 0;
      }
      .control-button::part(base) {
        width: 3rem;
        height: 1rem;
        justify-content: center;
      }
      .main-button {
        width: 15rem;
        margin-bottom: 1rem;
      }
      /* Make the tierlist dialog match the auction page's appearance */
      #tierlistDialog::part(body) {
        height: 100%;
        padding: 0;
      }

      #tierlistDialog sl-tab-panel::part(base) {
        padding: 0;
      }

      #tierlistDialog sl-tab-group {
        margin-top: 0;
      }

      /* Make the tabs only as tall as their content */
      #tierlistDialog sl-tab::part(base) {
        padding: var(--sl-spacing-2x-small) var(--sl-spacing-medium);
      }

      #tierlistDialog::part(header) {
        padding: 0; /* Remove padding to make it thinner */
        justify-content: flex-end; /* Push the content (the 'X' button) to the far right */
        border-bottom: none; /* Remove the line under the header */
      }

      #tierlistDialog::part(title) {
        display: none; /* Hide the title text */
      }

      #tierlistDialog::part(header-actions) {
        justify-content: flex-end; /* Push the 'X' button to the far right */
      }

      /* --- Home page Flygon silhouette background ---
         Fixed, non-interactive, low-opacity silhouette that fades in.
         Positioned so the left side sits off-screen and it doesn't affect layout. */
      .home-bg-silhouette {
        position: fixed;
        top: 50%;
        left: -20vw; /* push left so a large portion hangs off the page */
        transform: translateY(-50%);
        width: 90vw; /* large: roughly half the page width */
        height: auto;
        max-height: 120vh;
        /* We're using an <img src=> in the markup so no background-image here. */
        /* Make it a one-color silhouette (black) */
        filter: brightness(0) saturate(100%);
        /* Start invisible; animation will bring it to a low opacity */
        opacity: 0;
        pointer-events: none; /* don't intercept clicks */
        z-index: -1; /* keep it behind interactive UI */
        will-change: opacity;
        mix-blend-mode: multiply;
        object-fit: contain;
        /* Set final opacity directly. Animation will only run on initial load. */
        opacity: 0.05;
      }

      /* Only run the fade-in animation on the initial page load */
      body.initial-load .home-bg-silhouette {
        opacity: 0; /* Start invisible for the animation */
        animation: flygonFadeIn 3.6s ease forwards;
        animation-delay: 3.2s;
      }

      /* In dark mode, keep the silhouette dark (black) but slightly more visible than
         in light mode so it reads against a dark background. Do NOT invert to white. */
      .sl-theme-dark .home-bg-silhouette {
        mix-blend-mode: normal;
        opacity: 0.15;
      }

      /* Dark mode animation override for initial load */
      .sl-theme-dark body.initial-load .home-bg-silhouette {
        opacity: 0;
        animation-name: flygonFadeInDark;
      }

      @keyframes flygonFadeIn {
        from { opacity: 0; }
        to { opacity: 0.05; }
      }

      @keyframes flygonFadeInDark {
        from { opacity: 0; }
        /* slightly more visible on dark backgrounds */
        to { opacity: 0.12; }
      }
    </style>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/button/button.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/icon-button/icon-button.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/dialog/dialog.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/tab-group/tab-group.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/tab/tab.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/tab-panel/tab-panel.js"></script>
  </head>
  <body class="initial-load">
  <!-- Decorative, non-interactive Flygon silhouette background (use <img src=> so the file is fetched directly) -->
  <img class="home-bg-silhouette" src="/evolutions/Flygon.png" alt="" aria-hidden="true" />
    <div class="welcome-terminal"><span id="welcome-text"></span><span id="welcome-caret" aria-hidden="true">â–ˆ</span></div>
    <div style="display: flex; flex-direction: column; align-items: center;">
      <sl-button class="main-button" size="large" onclick="window.location.href='/setup'">Auction Setup</sl-button>
      <sl-button id="resource-mode-btn" class="main-button" size="large">Resource Dex</sl-button>
      <sl-button class="main-button" size="large" onclick="window.open('/assets/boss-battles.html', '_blank')">Boss Battles</sl-button>
    </div>

    <form id="resource-mode-form" method="post" action="new-auction" enctype="multipart/form-data" style="display: none;">
      <input name="resourceMode" value="true" />
      <input name="useDefaultCsv" value="true" />
    </form>

    <div style="position: fixed; bottom: 1rem; right: 1rem; display: flex; gap: 0.5rem">
      <sl-button id="drive-button" class="control-button" variant="neutral" title="Open Google Drive Folder">
        <img src="/generic/Drive.png" alt="Open Google Drive" style="height: 1.4rem; position: relative; top: 5px;" />
      </sl-button>
      <sl-button id="github-button" class="control-button" variant="neutral" title="Open GitHub Repository">
        <img class="invert-in-dark-mode" src="/generic/Github.png" alt="Open GitHub Repository" style="height: 1.4rem; position: relative; top: 5px;" />
      </sl-button>
      <sl-button id="youtube-button" class="control-button" variant="neutral" title="Open YouTube Channel">
        <img class="invert-in-dark-mode" src="/generic/Youtube.png" alt="YouTube" style="height: 1.6rem; position: relative; top: 6px;" />
      </sl-button>
      <sl-button id="tierlist-button" class="control-button" variant="neutral" title="View Tierlist">
        <img class="invert-in-dark-mode" src="/generic/TierIcon.png" alt="View Tierlist" style="height: 1.4rem; position: relative; top: 5px;" />
      </sl-button>
      <sl-button id="patchnotes-button" class="control-button" variant="neutral" title="View Patch Notes" onclick="window.location.href='/patchnotes'">
        <img class="invert-in-dark-mode" src="/generic/pencil.png" alt="Patch Notes" style="height: 1.4rem; position: relative; top: 5px;" />
      </sl-button>
      <sl-button id="dark-mode-toggle" class="control-button" variant="neutral"></sl-button>
    </div>

    <!-- Tierlist dialog for home page -->
  <sl-dialog id="tierlistDialog" label="Tierlist" style="--width: 60vw; --height: 80vh; display: none;">
      <sl-tab-group>
        <sl-tab slot="nav" panel="full-game" active>Full Game Tiers</sl-tab>
        <sl-tab slot="nav" panel="gym-1-5">Gym 1-5 Tiers</sl-tab>

        <sl-tab-panel name="full-game" active style="height: 100%;">
          <img src="/tierlist.png" alt="Full Game Tierlist" style="width: 100%; height: 100%; object-fit: contain;" />
        </sl-tab-panel>
        <sl-tab-panel name="gym-1-5" style="height: 100%;">
          <img src="/earlytiers.png" alt="Gym 1-5 Tierlist" style="width: 100%; height: 100%; object-fit: contain;" />
        </sl-tab-panel>
      </sl-tab-group>
    </sl-dialog>

    <script type="module">
      const slReady = customElements.whenDefined('sl-button');
      // expose promise so other scripts can wait for shoelace components
      window.slButtonsReadyPromise = slReady;
      await slReady;

      // --- Dark Mode Logic ---
      const darkModeToggle = document.getElementById('dark-mode-toggle');
      const htmlEl = document.documentElement;

      function applyTheme(theme) {
        if (theme === 'dark') {
            htmlEl.classList.add('sl-theme-dark');
            darkModeToggle.innerHTML = '<img class="invert-in-dark-mode" src="/generic/solrock.png" alt="Light Mode" style="height: 1.9rem; position: relative; top: 4px;">';
          } else {
            htmlEl.classList.remove('sl-theme-dark');
            darkModeToggle.innerHTML = '<img class="invert-in-dark-mode" src="/generic/lunatone.png" alt="Dark Mode" style="height: 1.9rem; position: relative; top: 4px;">';
          }
      }

    const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme);
      // Persist the chosen default so other pages load with the same initial theme
      if (!localStorage.getItem('theme')) {
        localStorage.setItem('theme', savedTheme);
      }

      darkModeToggle.addEventListener('click', () => {
        // Immediately remove the initial-load class to prevent re-animation
        document.body.classList.remove('initial-load');
        const newTheme = htmlEl.classList.contains('sl-theme-dark') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
      });
      // --- End Dark Mode Logic ---

      document.getElementById('resource-mode-btn').addEventListener('click', () => {
        document.getElementById('resource-mode-form').submit();
      });

      // Drive button listener
      document.getElementById('drive-button').addEventListener('click', () => {
        window.open('https://drive.google.com/drive/folders/1yY2AyLuR07CZCNowcPN22HTWS1184ZOx?usp=sharing', '_blank');
      });

      // GitHub button listener
      document.getElementById('github-button').addEventListener('click', () => {
        window.open('https://github.com/FranklyNathan/EmeraldBlitz', '_blank');
      });

      // YouTube button listener
      const ytBtn = document.getElementById('youtube-button');
      if (ytBtn) {
        ytBtn.addEventListener('click', () => {
          window.open('https://www.youtube.com/@PkmnEmeraldBlitz', '_blank');
        });
      }

      // Ensure dialog/tab components are ready before wiring the tierlist button
      await Promise.allSettled([
        customElements.whenDefined('sl-dialog'),
        customElements.whenDefined('sl-tab-group'),
        customElements.whenDefined('sl-tab'),
        customElements.whenDefined('sl-tab-panel')
      ]);

      // Tierlist button listener
      const tierlistButton = document.getElementById('tierlist-button');
      const tierlistDialog = document.getElementById('tierlistDialog');
      // Remove the temporary 'display: none' set in the markup now that the
      // dialog component is defined so the upgraded element can control visibility
      if (tierlistDialog) tierlistDialog.style.display = '';
      if (tierlistButton && tierlistDialog) {
        tierlistButton.addEventListener('click', () => {
          tierlistDialog.show();
        });
      }
    </script>
    <script>
      // Terminal-style typewriter welcome text (left-aligned)
      (function () {
        const text = 'Welcome to Emerald Blitz.';
        const el = document.getElementById('welcome-text');
        const caret = document.getElementById('welcome-caret');

        // NOTE: don't make page visible here. Visibility is enabled only after
        // shoelace components are defined so the buttons don't pop in after text.

        if (!el) return;

        let i = 0;
        const baseDelay = 60; // base ms per character

        function getDelay() {
          // small random jitter to make typing feel organic
          return baseDelay + Math.floor(Math.random() * 70) - 20;
        }

        function step() {
          if (i <= text.length) {
            el.textContent = text.slice(0, i);
            i += 1;
            setTimeout(step, getDelay());
          } else {
            // finished typing â€” leave caret blinking
          }
        }

        function startTyping() {
          // start typing shortly after ready so the rest of the page paints
          setTimeout(step, 120);
        }

        // Start typing only once the page is marked ready (shoelace components defined)
        if (document.body.classList.contains('ready')) {
          startTyping();
        } else if (window.slButtonsReadyPromise) {
          window.slButtonsReadyPromise.then(() => startTyping());
        } else {
          // Fallback to DOMContentLoaded
        // Also remove the initial-load class after the animation is guaranteed to be over
        setTimeout(() => {
          document.body.classList.remove('initial-load');
        }, 6800);
          document.addEventListener('DOMContentLoaded', () => startTyping());
        }
      })();

      // Wait for shoelace to be ready, then make the page visible so nothing pops in.
      if (window.slButtonsReadyPromise) {
        window.slButtonsReadyPromise.then(() => document.body.classList.add('ready'));
      } else {
        // Also remove the initial-load class after the animation is guaranteed to be over
        setTimeout(() => {
          document.body.classList.remove('initial-load');
        }, 6800);
        document.body.classList.add('ready');
      }
    </script>
  </body>
</html>