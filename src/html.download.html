<!doctype html>
<html class="sl-theme-dark">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Download - Auction Draft</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/themes/light.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/themes/dark.css" />
    <link rel="stylesheet" href="/style.css" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      .download-button {
        width: 15rem;
      }
      .logo {
        max-width: 34%;
        height: auto;
        margin-bottom: 1.5rem;
      }
      /* Dark-mode toggle / control-button helpers */
      .sl-theme-dark .invert-in-dark-mode {
        filter: invert(1);
      }
      .instructions {
        margin-top: 0.5rem;
        max-width: 30rem;
        text-align: center;
      }
      .version-info {
        margin-bottom: 0.2rem; /* Adjust this value to control the space */
      }
    </style>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/button/button.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/icon-button/icon-button.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/components/icon/icon.js"></script>
    <script>
      // Set the base path for Shoelace assets (required for icons)
      document.documentElement.style.setProperty('--sl-base-path', 'https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/');
    </script>
  </head>
  <body class="ready">
    <img src="/blitzlogo.png" alt="Emerald Blitz Logo" class="logo" />
    <sl-button id="download-patch-button" class="download-button" size="large">Download Patch</sl-button>
    <p class="version-info">Current Release: v7.6</p>
    <p class="instructions">
      Once downloaded, apply the patch online using this <a href="https://www.marcrobledo.com/RomPatcher.js/" target="_blank" rel="noopener noreferrer">ROM Patcher</a>
    </p>

    <div style="position: fixed; bottom: 1rem; right: 1rem; display: flex; gap: 0.5rem; height: 4rem; align-items: center;">
      <sl-button id="home-button" class="control-button" variant="neutral" title="Home" href="/">
        <img class="invert-in-dark-mode" src="/generic/Home.png" alt="Home" />
      </sl-button>
      <sl-button id="dark-mode-toggle" class="control-button" variant="neutral"></sl-button>
    </div>

    <script type="module">
      // Set the base path for Shoelace assets (like icons) before any components are rendered.
      import { setBasePath } from 'https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/utilities/base-path.js';
      setBasePath('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/');

      // Wait for all shoelace components used on the page to be defined.
      await Promise.all([customElements.whenDefined('sl-button'), customElements.whenDefined('sl-icon-button')]);

      // --- Dark Mode Logic ---
      const darkModeToggle = document.getElementById('dark-mode-toggle');
      const htmlEl = document.documentElement;

      function applyTheme(theme) {
        if (theme === 'dark') {
          htmlEl.classList.add('sl-theme-dark');
          darkModeToggle.innerHTML = '<img class="invert-in-dark-mode" src="/generic/solrock.png" alt="Light Mode">';
        } else {
          htmlEl.classList.remove('sl-theme-dark');
          darkModeToggle.innerHTML = '<img class="invert-in-dark-mode" src="/generic/lunatone.png" alt="Dark Mode">';
        }
      }

      const savedTheme = localStorage.getItem('theme') || 'dark';
      applyTheme(savedTheme);
      if (!localStorage.getItem('theme')) {
        localStorage.setItem('theme', savedTheme);
      }

      darkModeToggle.addEventListener('click', () => {
        const newTheme = htmlEl.classList.contains('sl-theme-dark') ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
      });
      // --- End Dark Mode Logic ---

      // Download button listener
      document.getElementById('download-patch-button').addEventListener('click', () => {
        // Create an anchor element
        const link = document.createElement('a');
        // Set the href to the file path
        link.href = '/emeraldblitz.bps';
        // Set the download attribute with the desired filename
        link.download = 'emeraldblitz.bps';
        // Append the link to the body (required for Firefox)
        document.body.appendChild(link);
        // Programmatically click the link to trigger the download
        link.click();
        // Remove the link from the document
        document.body.removeChild(link);
      });
    </script>
  </body>
</html>